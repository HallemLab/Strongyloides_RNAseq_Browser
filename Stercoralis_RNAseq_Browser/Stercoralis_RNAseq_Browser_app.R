# Stercoralis RNAseq Browser Shiny App

## ---- Libraries ----
library(shiny)
library(htmltools)
library(shinydashboard)
library(tidyverse)
library(ggplot2)
library(RColorBrewer)
library(ggdendro)
library(magrittr)
library(factoextra)
library(gridExtra)
library(cowplot)
library(dendextend)
library(DT)

## ---- Background ----
# Load pre-calculated data generated by S_stercoralis_RNAseq_ReAnalysis.R
load(file = "../Stercoralis_RNAseq_Browser/SsLifeStageComparisons_subset")
print("Data Loaded Successfully")

## ---- UI ----

ui <- fluidPage(
    
    # Application title
    titlePanel("Strongyloides stercoralis RNAseq Browser"),
    
    
    fluidRow(
        ## User Input Options ----
        column(4,
               selectInput("selectTarget",
                                  h3("Select Target"),
                                  choices = list("FLF",
                                                 "PF",
                                                 "iL3",
                                                 "iL3a",
                                                 "ppL1",
                                                 "ppL3",
                                                 "pfL1"),
                                  selected = "iL3"),
               selectInput("selectContrast",
                                  h3("Select Contrast"),
                           choices = list("FLF",
                                          "PF",
                                          "iL3",
                                          "iL3a",
                                          "ppL1",
                                          "ppL3",
                                          "pfL1"),
                                  selected = "FLF")
               
        ),
        
        
        # Reactive Outputs ----
        column(8,
               wellPanel(
                   DTOutput('tbl')
               ))
    )
)


# Define server logic required to draw a histogram
server <- function(input, output, session) {
    
    vals <-  vals <- reactiveValues(DEGtbl = NULL)

    output$tbl <- renderDT ({
        targetStage <- input$selectTarget
        contrastStage <- input$selectContrast
        comparison <- paste(targetStage, contrastStage, sep = "-")
        vals$DEGtbl <- output.SsRNAseq[[comparison]]$DEG.datatable
        vals$DEGtbl
    })
    
    
    # output$heatmap <- renderPlot({
    #     myheatcolors <- rev(brewer.pal(name="RdBu", n=11))
    #     
    #    eval(output.SsRNAseq$General$diffGenes.heatmap.bygroup$call)
    # })
    
    session$onSessionEnded(stopApp)
}

# Run the application 
shinyApp(ui = ui, server = server)
